
{% extends 'base.html' %}
{% block content %}
  <h4>Audit Details</h4>
  <div class="row g-3">
    <div class="col-md-4"><div class="p-3 rounded bg-dark-subtle">
      <div>Overall Score</div>
      <div class="display-6">{{ audit.result_json.overall_score }}</div>
      <div>Grade: {{ audit.result_json.grade }}</div>
    </div></div>
    <div class="col-md-8"><canvas id="adBreakdown" height="120"></canvas></div>
  </div>
  <hr/>
  <ul class="nav nav-tabs" id="mtabs" role="tablist">
    <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#exec">Executive</button></li>
    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#overall">Overall Health</button></li>
    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#crawl">Crawl & Index</button></li>
    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#onpage">On-Page</button></li>
    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#perf">Performance</button></li>
    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#mobile">Mobile & Security</button></li>
    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#broken">Broken Links</button></li>
    <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#growth">Opportunities</button></li>
  </ul>
  <div class="tab-content p-3 border border-top-0 rounded-bottom bg-body-tertiary">
    <div class="tab-pane fade show active" id="exec"><h5>Executive Summary</h5><p>{{ audit.result_json.executive_summary }}</p></div>
    <div class="tab-pane fade" id="overall">{% include 'partials/overall_health.html' %}</div>
    <div class="tab-pane fade" id="crawl">{% include 'partials/crawl_index.html' %}</div>
    <div class="tab-pane fade" id="onpage">{% include 'partials/onpage.html' %}</div>
    <div class="tab-pane fade" id="perf">{% include 'partials/performance.html' %}</div>
    <div class="tab-pane fade" id="mobile">{% include 'partials/mobile_security.html' %}</div>
    <div class="tab-pane fade" id="broken">{% include 'partials/broken_links.html' %}</div>
    <div class="tab-pane fade" id="growth">{% include 'partials/opportunities.html' %}</div>
  </div>
  <script>
    (function(){
      const r = {{ audit.result_json | tojson }};
      new Chart(document.getElementById('adBreakdown'), {type:'bar', data:{labels:Object.keys(r.breakdown), datasets:[{label:'Score', data:Object.values(r.breakdown)}]}});
    })();
  </script>
{% endblock %}
