<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web Audit Dashboard</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
      min-height: 100vh;
    }
    .card {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    .audit-title {
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .progress {
      height: 14px;
      background: #020617;
    }
    .progress-bar {
      background: linear-gradient(90deg, #3b82f6, #22c55e);
    }
    .log-box {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 10px;
      padding: 12px;
      height: 160px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.85rem;
      color: #22c55e;
    }
  </style>
</head>
<body>

<div class="container py-5">

  <div class="row mb-4">
    <div class="col text-center">
      <h2 class="audit-title">ðŸš€ FF Tech â€“ AI Web Audit Engine</h2>
      <p class="text-secondary">Real-time website audit with instant insights</p>
    </div>
  </div>

  <!-- URL Input -->
  <div class="row mb-4">
    <div class="col-lg-8 mx-auto">
      <div class="card p-4">
        <label class="form-label">Website URL</label>
        <div class="input-group">
          <input id="urlInput" class="form-control" placeholder="https://www.example.com" />
          <button class="btn btn-primary" onclick="startAudit()">Start Audit</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Progress -->
  <div class="row mb-4">
    <div class="col-lg-8 mx-auto">
      <div class="card p-4">
        <h6>Audit Progress</h6>
        <div class="progress mt-2">
          <div id="progressBar" class="progress-bar" style="width:0%"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card p-4">
        <h6>SEO & Performance Score</h6>
        <canvas id="scoreChart"></canvas>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card p-4">
        <h6>Issues Breakdown</h6>
        <canvas id="issueChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Logs -->
  <div class="row mt-4">
    <div class="col-lg-12">
      <div class="card p-4">
        <h6>Live Audit Log</h6>
        <div id="logBox" class="log-box"></div>
      </div>
    </div>
  </div>

</div>

<script>
let ws;

const scoreChart = new Chart(document.getElementById('scoreChart'), {
  type: 'bar',
  data: {
    labels: ['SEO', 'Performance', 'Security', 'Accessibility'],
    datasets: [{ data: [0,0,0,0] }]
  },
  options: { scales: { y: { min: 0, max: 100 } } }
});

const issueChart = new Chart(document.getElementById('issueChart'), {
  type: 'doughnut',
  data: {
    labels: ['Critical', 'Warnings', 'Passed'],
    datasets: [{ data: [0,0,0] }]
  }
});

function startAudit() {
  const url = document.getElementById('urlInput').value;
  document.getElementById('logBox').innerHTML = '';
  document.getElementById('progressBar').style.width = '0%';

  ws = new WebSocket(`ws://${location.host}/ws/audit-progress?url=${encodeURIComponent(url)}`);

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    if (data.progress !== undefined) {
      document.getElementById('progressBar').style.width = data.progress + '%';
    }

    if (data.log) {
      document.getElementById('logBox').innerHTML += data.log + '<br>';
    }

    if (data.scores) {
      scoreChart.data.datasets[0].data = data.scores;
      scoreChart.update();
    }

    if (data.issues) {
      issueChart.data.datasets[0].data = data.issues;
      issueChart.update();
    }
  };
}
</script>

</body>
</html>
