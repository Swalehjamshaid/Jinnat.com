<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Website Audit Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --radius: 18px;
      --glass: rgba(255,255,255,.07);
      --glassBorder: rgba(255,255,255,.12);
      --shadow: 0 18px 45px rgba(0,0,0,.35);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.62);
      --bg0: rgba(2,6,23,1);
      --bg1: rgba(3,7,18,1);
      --brandA: rgba(14,165,233,.95);
      --brandB: rgba(99,102,241,.90);
      --good: #22c55e;
      --warn: #fbbf24;
      --bad: #ef4444;
      --info: #38bdf8;
    }
    body {
      min-height: 100vh;
      background: radial-gradient(1200px 600px at 25% 15%, rgba(14,165,233,.22), transparent 55%),
                  radial-gradient(900px 520px at 75% 8%, rgba(34,197,94,.16), transparent 52%),
                  radial-gradient(800px 520px at 65% 85%, rgba(239,68,68,.12), transparent 52%),
                  linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    .app-shell { max-width: 1200px; margin: 0 auto; padding: 22px 16px 70px; }
    .glass {
      background: var(--glass);
      border: 1px solid var(--glassBorder);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand-badge {
      width: 46px; height: 46px;
      border-radius: 14px;
      display: grid; place-items: center;
      font-weight: 900;
      letter-spacing: .5px;
      background: linear-gradient(135deg, var(--brandA), var(--brandB));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 18px 40px rgba(14,165,233,.22);
    }
    .subtle { color: var(--muted); }
    .muted-2 { color: var(--muted2); }
    .pill {
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: rgba(255,255,255,.80);
      user-select: none;
      white-space: nowrap;
    }
    .btn-glow {
      background: linear-gradient(135deg, var(--brandA), var(--brandB));
      border: none;
      box-shadow: 0 18px 45px rgba(14,165,233,.22);
    }
    .btn-glow:hover { filter: brightness(1.06); transform: translateY(-1px); }
    .btn-glow:active { transform: translateY(0); }
    .progress { height: 10px; }
    .progress-bar { transition: width .20s ease; }
    .mini-card {
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding: 14px;
      height: 100%;
    }
    .mini-card .label { font-size: 12px; opacity: .82; }
    .mini-card .value { font-size: 34px; font-weight: 900; line-height: 1.1; }
    .mini-card .hint { font-size: 12px; opacity: .72; margin-top: 8px; }
    .kv-table td, .kv-table th { border-color: rgba(255,255,255,.10)!important; }
    .fade-in { animation: fadeIn .30s ease both; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(8px)} to {opacity:1; transform: translateY(0)} }
    .score-ring {
      width: 180px; height: 180px;
      border-radius: 999px;
      position: relative;
      display: grid; place-items: center;
      background: conic-gradient(from 180deg, rgba(14,165,233,.95) var(--deg), rgba(255,255,255,.08) 0);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 18px 45px rgba(0,0,0,.35);
    }
    .score-ring .inside {
      width: 132px; height: 132px;
      border-radius: 999px;
      background: rgba(2,6,23,.75);
      border: 1px solid rgba(255,255,255,.12);
      display: grid; place-items: center;
      text-align: center;
      padding: 10px;
    }
    .score-ring .score { font-size: 40px; font-weight: 950; line-height: 1; }
    .score-ring .grade { font-weight: 900; margin-top: 4px; opacity: .92; }
    .score-ring .tiny { font-size: 12px; opacity: .78; margin-top: 6px; }
    .status-chip {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size: 12px;
    }
    .dot { width: 8px; height: 8px; border-radius: 999px; background: rgba(255,255,255,.35); }
    .dot.ok { background: var(--good); box-shadow: 0 0 0 6px rgba(34,197,94,.16); }
    .dot.warn { background: var(--warn); box-shadow: 0 0 0 6px rgba(251,191,36,.16); }
    .dot.bad { background: var(--bad); box-shadow: 0 0 0 6px rgba(239,68,68,.16); }
    .dot.info { background: var(--info); box-shadow: 0 0 0 6px rgba(56,189,248,.16); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .section-title { font-weight: 800; letter-spacing: .2px; }
    .chip { display:inline-block; border-radius: 999px; padding: 4px 10px; border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); font-size: 12px;}
    .img-box { border-radius: 16px; overflow: hidden; border:1px solid rgba(255,255,255,.12); }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- HEADER -->
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div class="d-flex align-items-center gap-3">
        <div class="brand-badge text-white">FF</div>
        <div>
          <div class="h4 mb-0 fw-bold">Website Audit Pro</div>
          <div class="subtle small">Runner.py results ‚Ä¢ WebSocket progress ‚Ä¢ PDF export</div>
        </div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <span id="wsStatus" class="pill">WS: Disconnected</span>
        <button class="btn btn-sm btn-outline-secondary" id="themeToggle" type="button" aria-label="Toggle theme">üåô / ‚òÄÔ∏è</button>
      </div>
    </div>

    <!-- INPUT + PROGRESS -->
    <div class="glass p-4 mb-4">
      <div class="row g-3 align-items-end">
        <div class="col-lg-7">
          <label class="form-label fw-semibold">Website URL / Domain</label>
          <input id="urlInput" type="text" class="form-control form-control-lg"
                 placeholder="haier.com.pk or www.haier.com.pk"
                 value="https://www.apple.com" />
          <div class="small muted-2 mt-1">Just type the domain ‚Äî https:// is added automatically.</div>
        </div>
        <div class="col-lg-5">
          <div class="d-grid gap-2 d-lg-flex justify-content-lg-end">
            <button id="startBtn" class="btn btn-lg btn-glow text-white fw-semibold" type="button">
              ‚ñ∂ Start Audit
            </button>
            <button id="pdfBtn" class="btn btn-lg btn-outline-info fw-semibold" type="button" disabled>
              ‚¨á Download Professional PDF
            </button>
          </div>
        </div>
      </div>
      <hr class="my-4 border-0" style="border-top:1px solid rgba(255,255,255,.12)">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <div class="fw-semibold">Progress</div>
        <div class="d-flex align-items-center gap-2">
          <span class="status-chip" id="stageChip"><span class="dot info" id="stageDot"></span><span id="statusText">idle</span></span>
          <span class="subtle"><span id="progressText">0%</span></span>
        </div>
      </div>
      <div class="progress glass" style="border-radius:999px;">
        <div id="progressBar" class="progress-bar bg-info" role="progressbar" style="width:0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div id="alertArea" class="mt-3"></div>
      <div class="mt-3">
        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#debugCollapse">
          Debug (last message / last result)
        </button>
        <div class="collapse mt-2" id="debugCollapse">
          <div class="glass p-3 mono small" id="debugBox">No messages yet.</div>
        </div>
      </div>
    </div>

    <!-- RESULTS AREA -->
    <div id="resultsArea" class="row g-3 mb-4" style="display:none;">
      <div class="col-lg-4">
        <div class="glass p-4 h-100 text-center">
          <div class="score-ring mx-auto" id="scoreRing" style="--deg:0deg;">
            <div class="inside">
              <div class="score" id="overallScore">0</div>
              <div class="grade" id="gradeText">‚Äî</div>
              <div class="tiny" id="auditedUrl">Audited: ‚Äî</div>
            </div>
          </div>
          <div class="mt-3 d-flex justify-content-center gap-2 flex-wrap">
            <span class="pill" id="lastRunAt">‚Äî</span>
            <span class="pill" id="fetcherPill">fetcher: ‚Äî</span>
          </div>
          <div class="mt-3 subtle small">
            Overall score is computed from SEO, Performance, Links, and Security.
          </div>
          <div class="mt-3 d-flex justify-content-center gap-2 flex-wrap">
            <button id="copyJsonBtn" class="btn btn-sm btn-outline-secondary" type="button">Copy JSON</button>
            <button id="openJsonBtn" class="btn btn-sm btn-outline-secondary" type="button">Open JSON</button>
          </div>
        </div>
      </div>
      <div class="col-lg-8">
        <div class="glass p-4 h-100">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div>
              <div class="h5 mb-0 fw-bold">Score Breakdown</div>
              <div class="subtle small">Chart comes directly from runner.py chart_data</div>
            </div>
            <span class="pill" id="verdictPill">verdict: ‚Äî</span>
          </div>
          <canvas id="breakdownChart" height="120"></canvas>
        </div>
      </div>
    </div>

    <!-- CATEGORY CARDS -->
    <div id="cardsArea" class="row g-3 mb-4" style="display:none;">
      <div class="col-md-6 col-lg-3">
        <div class="mini-card">
          <div class="label">SEO</div>
          <div class="value" id="seoScore">‚Äî</div>
          <div class="hint">Title, meta, H1, canonical, image ALT</div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="mini-card">
          <div class="label">Performance</div>
          <div class="value" id="perfScore">‚Äî</div>
          <div class="hint">Load time, size, scripts, styles</div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="mini-card">
          <div class="label">Links</div>
          <div class="value" id="linksScore">‚Äî</div>
          <div class="hint">Internal vs external structure</div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="mini-card">
          <div class="label">Security</div>
          <div class="value" id="secScore">‚Äî</div>
          <div class="hint">HTTPS, HSTS, response status</div>
        </div>
      </div>
    </div>

    <!-- EXTRAS (runner.breakdown.extras nicely formatted) -->
    <div id="extrasArea" class="row g-3 mb-4" style="display:none;">
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="h5 fw-bold mb-3 section-title">SEO Details</div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <tbody id="seoExtrasBody"></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="h5 fw-bold mb-3 section-title">Performance Details</div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <tbody id="perfExtrasBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- OPTIONAL ENRICHMENTS (render only if present) -->
    <div id="enrichmentsArea" class="row g-3 mb-4" style="display:none;">
      <!-- Lighthouse/PSI -->
      <div class="col-lg-6" id="lighthouseCard" style="display:none;">
        <div class="glass p-4 h-100">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="h5 fw-bold mb-0">Lighthouse (PSI)</div>
            <span class="pill" id="lhrPerfChip">Performance: ‚Äî</span>
          </div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-2">
              <tbody id="lhrMetricsBody"></tbody>
            </table>
          </div>
          <div class="accordion" id="psiAccordion">
            <div class="accordion-item">
              <h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#psiOpp">Opportunities</button></h2>
              <div id="psiOpp" class="accordion-collapse collapse"><div class="accordion-body"><ul id="psiOppList" class="mb-0"></ul></div></div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#psiDiag">Diagnostics</button></h2>
              <div id="psiDiag" class="accordion-collapse collapse"><div class="accordion-body"><ul id="psiDiagList" class="mb-0"></ul></div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Core Web Vitals (Field/Lab) -->
      <div class="col-lg-6" id="cwvCard" style="display:none;">
        <div class="glass p-4 h-100">
          <div class="h5 fw-bold mb-3">Core Web Vitals</div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <thead><tr><th>Metric</th><th>Desktop</th><th>Mobile</th></tr></thead>
              <tbody id="cwvBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Robots & Sitemap -->
      <div class="col-lg-6" id="robotsCard" style="display:none;">
        <div class="glass p-4 h-100">
          <div class="h5 fw-bold mb-3">Robots.txt & Sitemap</div>
          <div id="robotsNote" class="subtle small mb-2"></div>
          <ul id="sitemapList" class="mb-2"></ul>
          <div id="sitemapSummary" class="chip">‚Äî</div>
        </div>
      </div>

      <!-- Structured Data -->
      <div class="col-lg-6" id="schemaCard" style="display:none;">
        <div class="glass p-4 h-100">
          <div class="h5 fw-bold mb-3">Structured Data (JSON-LD)</div>
          <div id="schemaDetected" class="chip">Detected: ‚Äî</div>
          <ul id="schemaTypes" class="mt-2"></ul>
        </div>
      </div>

      <!-- Mobile Heuristics -->
      <div class="col-lg-6" id="mobileCard" style="display:none;">
        <div class="glass p-4 h-100">
          <div class="h5 fw-bold mb-3">Mobile Heuristics</div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <tbody id="mobileBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Accessibility (axe-core) -->
      <div class="col-lg-6" id="a11yCard" style="display:none;">
        <div class="glass p-4 h-100">
          <div class="h5 fw-bold mb-3">Accessibility (axe-core)</div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-2">
              <tbody id="a11yBody"></tbody>
            </table>
          </div>
          <details class="mt-2">
            <summary class="subtle">Top Issues</summary>
            <ul id="a11yIssues" class="mt-2"></ul>
          </details>
        </div>
      </div>

      <!-- Homepage Screenshot (if provided) -->
      <div class="col-12" id="screenshotCard" style="display:none;">
        <div class="glass p-4">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="h5 fw-bold mb-0">Homepage Screenshot</div>
            <span id="screenInfo" class="pill">source: runner.assets</span>
          </div>
          <div class="img-box"><img id="homepageImg" src="" alt="Homepage screenshot" class="img-fluid"></div>
        </div>
      </div>

      <!-- Benchmarks / Competitors -->
      <div class="col-lg-6" id="benchCard" style="display:none;">
        <div class="glass p-4 h-100">
          <div class="h5 fw-bold mb-3">Industry Benchmark</div>
          <div id="benchIndustry" class="chip">Industry: ‚Äî</div>
          <ul id="benchList" class="mt-2"></ul>
        </div>
      </div>
      <div class="col-lg-6" id="compCard" style="display:none;">
        <div class="glass p-4 h-100">
          <div class="h5 fw-bold mb-3">Competitive Snapshot</div>
          <ul id="compList" class="mt-2"></ul>
        </div>
      </div>
    </div>

    <!-- DYNAMIC OUTPUT -->
    <div id="dynamicArea" class="row g-3" style="display:none;">
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="h5 fw-bold mb-0">Highlights</div>
            <span class="pill">runner.dynamic.cards</span>
          </div>
          <div id="dynamicCards" class="d-grid gap-2"></div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="h5 fw-bold mb-0">Details</div>
            <span class="pill">runner.dynamic.kv</span>
          </div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <tbody id="kvBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center mt-5 subtle small">
      ¬© FF Tech ‚Ä¢ WebSocket <code>/ws</code> ‚Ä¢ REST <code>/api/audit/run</code> ‚Ä¢ PDF <code>/api/audit/pdf</code>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // =========================================================
    // CONTROLLER ‚Äì FULL RENDERING OF RUNNER.PY RESULT
    // =========================================================
    const REST_FALLBACK_AFTER_MS = 9000;
    const AUTO_SCROLL_ON_RESULT = true;
    let ws = null;
    let lastResult = null;
    let chart = null;
    let fallbackTimer = null;
    let auditInProgress = false;

    const el = (id) => document.getElementById(id);

    // Theme toggle
    const themeKey = "fftech_theme";
    function setTheme(theme) {
      document.documentElement.setAttribute("data-bs-theme", theme);
      localStorage.setItem(themeKey, theme);
    }
    (function initTheme() {
      const saved = localStorage.getItem(themeKey);
      if (saved) setTheme(saved);
    })();
    el("themeToggle").addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-bs-theme") || "dark";
      setTheme(current === "dark" ? "light" : "dark");
    });

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;").replaceAll("'", "&#39;");
    }

    function showAlert(message, type="info", persist=false) {
      const area = el("alertArea");
      const div = document.createElement("div");
      div.className = `alert alert-${type} mb-2 fade-in`;
      div.innerHTML = `
        <div class="d-flex align-items-start justify-content-between gap-3">
          <div>${message}</div>
          <button type="button" class="btn-close" aria-label="Close"></button>
        </div>`;
      div.querySelector(".btn-close").onclick = () => div.remove();
      area.prepend(div);
      if (!persist) setTimeout(() => div.remove(), 6500);
    }

    function setStage(status, percent) {
      const p = Math.max(0, Math.min(100, parseInt(percent || 0)));
      el("progressBar").style.width = `${p}%`;
      el("progressText").textContent = `${p}%`;
      el("statusText").textContent = status || "working";
      const bar = el("progressBar");
      bar.classList.remove("bg-info","bg-success","bg-warning","bg-danger");
      if (status === "error" || status === "failed") bar.classList.add("bg-danger");
      else if (p >= 100) bar.classList.add("bg-success");
      else bar.classList.add("bg-info");
      const dot = el("stageDot");
      dot.classList.remove("ok","warn","bad","info");
      if (status === "error" || status === "failed") dot.classList.add("bad");
      else if (p >= 100) dot.classList.add("ok");
      else dot.classList.add("info");
    }

    function setWsStatus(connected) {
      el("wsStatus").textContent = connected ? "WS: Connected" : "WS: Disconnected";
      el("wsStatus").style.opacity = connected ? "1" : "0.75";
    }

    function wsUrl() {
      const loc = window.location;
      const proto = loc.protocol === "https:" ? "wss:" : "ws:";
      return `${proto}//${loc.host}/ws`;
    }

    function debugSet(obj) {
      el("debugBox").textContent = JSON.stringify(obj, null, 2);
    }

    function extractRunnerResult(obj) {
      if (!obj || typeof obj !== "object") return null;
      if (obj.audited_url && typeofGot it, Khan. Below is an **updated `index.html`** that stays **100% compatible** with your existing backend (same inputs, same outputs, same links: `/ws`, `/api/audit/run`, `/api/audit/pdf`).  

What‚Äôs improved:

- **No changes to input/output contracts** ‚úÖ
- **Richer on-page insights from `runner.py`** (all attributes already returned by your runner are now rendered):
  - **SEO extras:** title length, meta description present, canonical, H1 count, image ALT coverage.
  - **Performance extras:** load time (ms), total bytes (KB), scripts, styles, fetcher.
  - **Links:** internal, external, total counts.
  - **Security:** HTTPS, HSTS, status code, server header preview.
- **Safer UI** (guards against missing values).
- **Same elegant dark/light UI, Bootstrap 5 + Chart.js**.
- **Zero reliance on PDF-only enrichments** (PSI/axe/screenshot/robots/schema)‚Äîthe page won‚Äôt try to show them, because your runner‚Äôs `run()` output hasn‚Äôt changed (by design). Those enrichments flow only into the PDF path.

> If you later decide to expose PSI/axe/robots/schema into the runner API, you can add small readouts in this template where marked (look for `// OPTIONAL: ...` comments).

---

## üîÅ Drop-in replacement: `index.html`

```html
<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Website Audit Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --radius: 18px;
      --glass: rgba(255,255,255,.07);
      --glassBorder: rgba(255,255,255,.12);
      --shadow: 0 18px 45px rgba(0,0,0,.35);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.62);
      --bg0: rgba(2,6,23,1);
      --bg1: rgba(3,7,18,1);
      --brandA: rgba(14,165,233,.95);
      --brandB: rgba(99,102,241,.90);
      --good: #22c55e;
      --warn: #fbbf24;
      --bad: #ef4444;
      --info: #38bdf8;
    }
    body {
      min-height: 100vh;
      background: radial-gradient(1200px 600px at 25% 15%, rgba(14,165,233,.22), transparent 55%),
                  radial-gradient(900px 520px at 75% 8%, rgba(34,197,94,.16), transparent 52%),
                  radial-gradient(800px 520px at 65% 85%, rgba(239,68,68,.12), transparent 52%),
                  linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    .app-shell { max-width: 1200px; margin: 0 auto; padding: 22px 16px 70px; }
    .glass {
      background: var(--glass);
      border: 1px solid var(--glassBorder);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .brand-badge {
      width: 46px; height: 46px;
      border-radius: 14px;
      display: grid; place-items: center;
      font-weight: 900;
      letter-spacing: .5px;
      background: linear-gradient(135deg, var(--brandA), var(--brandB));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 18px 40px rgba(14,165,233,.22);
    }
    .subtle { color: var(--muted); }
    .muted-2 { color: var(--muted2); }
    .pill {
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: rgba(255,255,255,.80);
      user-select: none;
      white-space: nowrap;
    }
    .btn-glow {
      background: linear-gradient(135deg, var(--brandA), var(--brandB));
      border: none;
      box-shadow: 0 18px 45px rgba(14,165,233,.22);
    }
    .btn-glow:hover { filter: brightness(1.06); transform: translateY(-1px); }
    .btn-glow:active { transform: translateY(0); }
    .progress { height: 10px; }
    .progress-bar { transition: width .20s ease; }
    .mini-card {
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding: 14px;
      height: 100%;
    }
    .mini-card .label { font-size: 12px; opacity: .82; }
    .mini-card .value { font-size: 34px; font-weight: 900; line-height: 1.1; }
    .mini-card .hint { font-size: 12px; opacity: .72; margin-top: 8px; }
    .kv-table td, .kv-table th { border-color: rgba(255,255,255,.10)!important; }
    .fade-in { animation: fadeIn .30s ease both; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(8px)} to {opacity:1; transform: translateY(0)} }
    .score-ring {
      width: 180px; height: 180px;
      border-radius: 999px;
      position: relative;
      display: grid; place-items: center;
      background: conic-gradient(from 180deg, rgba(14,165,233,.95) var(--deg), rgba(255,255,255,.08) 0);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 18px 45px rgba(0,0,0,.35);
    }
    .score-ring .inside {
      width: 132px; height: 132px;
      border-radius: 999px;
      background: rgba(2,6,23,.75);
      border: 1px solid rgba(255,255,255,.12);
      display: grid; place-items: center;
      text-align: center;
      padding: 10px;
    }
    .score-ring .score { font-size: 40px; font-weight: 950; line-height: 1; }
    .score-ring .grade { font-weight: 900; margin-top: 4px; opacity: .92; }
    .score-ring .tiny { font-size: 12px; opacity: .78; margin-top: 6px; }
    .status-chip {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 6px 10px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size: 12px;
    }
    .dot { width: 8px; height: 8px; border-radius: 999px; background: rgba(255,255,255,.35); }
    .dot.ok { background: var(--good); box-shadow: 0 0 0 6px rgba(34,197,94,.16); }
    .dot.warn { background: var(--warn); box-shadow: 0 0 0 6px rgba(251,191,36,.16); }
    .dot.bad { background: var(--bad); box-shadow: 0 0 0 6px rgba(239,68,68,.16); }
    .dot.info { background: var(--info); box-shadow: 0 0 0 6px rgba(56,189,248,.16); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .sect-head { display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px; }
    .sect-head .title { font-weight: 700; font-size: 1rem; }
    .kv { display:flex; flex-wrap:wrap; gap:8px; }
    .kv .kv-item { padding:6px 10px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:12px; font-size:12px;}
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- HEADER -->
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div class="d-flex align-items-center gap-3">
        <div class="brand-badge text-white">FF</div>
        <div>
          <div class="h4 mb-0 fw-bold">Website Audit Pro</div>
          <div class="subtle small">Runner.py results ‚Ä¢ WebSocket progress ‚Ä¢ PDF export</div>
        </div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <span id="wsStatus" class="pill">WS: Disconnected</span>
        <button class="btn btn-sm btn-outline-secondary" id="themeToggle" type="button" aria-label="Toggle theme">üåô / ‚òÄÔ∏è</button>
      </div>
    </div>

    <!-- INPUT + PROGRESS -->
    <div class="glass p-4 mb-4">
      <div class="row g-3 align-items-end">
        <div class="col-lg-7">
          <label class="form-label fw-semibold">Website URL / Domain</label>
          <input id="urlInput" type="text" class="form-control form-control-lg"
                 placeholder="haier.com.pk or www.haier.com.pk"
                 value="https://www.apple.com" />
          <div class="small muted-2 mt-1">Just type the domain ‚Äî https:// is added automatically.</div>
        </div>
        <div class="col-lg-5">
          <div class="d-grid gap-2 d-lg-flex justify-content-lg-end">
            <button id="startBtn" class="btn btn-lg btn-glow text-white fw-semibold" type="button">
              ‚ñ∂ Start Audit
            </button>
            <button id="pdfBtn" class="btn btn-lg btn-outline-info fw-semibold" type="button" disabled>
              ‚¨á Download Professional PDF
            </button>
          </div>
        </div>
      </div>
      <hr class="my-4 border-0" style="border-top:1px solid rgba(255,255,255,.12)">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <div class="fw-semibold">Progress</div>
        <div class="d-flex align-items-center gap-2">
          <span class="status-chip" id="stageChip"><span class="dot info" id="stageDot"></span><span id="statusText">idle</span></span>
          <span class="subtle"><span id="progressText">0%</span></span>
        </div>
      </div>
      <div class="progress glass" style="border-radius:999px;">
        <div id="progressBar" class="progress-bar bg-info" role="progressbar" style="width:0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div id="alertArea" class="mt-3"></div>
      <div class="mt-3">
        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#debugCollapse">
          Debug (last message / last result)
        </button>
        <div class="collapse mt-2" id="debugCollapse">
          <div class="glass p-3 mono small" id="debugBox">No messages yet.</div>
        </div>
      </div>
    </div>

    <!-- RESULTS AREA -->
    <div id="resultsArea" class="row g-3 mb-4" style="display:none;">
      <div class="col-lg-4">
        <div class="glass p-4 h-100 text-center">
          <div class="score-ring mx-auto" id="scoreRing" style="--deg:0deg;">
            <div class="inside">
              <div class="score" id="overallScore">0</div>
              <div class="grade" id="gradeText">‚Äî</div>
              <div class="tiny" id="auditedUrl">Audited: ‚Äî</div>
            </div>
          </div>
          <div class="mt-3 d-flex justify-content-center gap-2 flex-wrap">
            <span class="pill" id="lastRunAt">‚Äî</span>
            <span class="pill" id="fetcherPill">fetcher: ‚Äî</span>
          </div>
          <div class="mt-3 subtle small">
            Overall score is computed from SEO, Performance, Links, and Security.
          </div>
          <div class="mt-3 d-flex justify-content-center gap-2 flex-wrap">
            <button id="copyJsonBtn" class="btn btn-sm btn-outline-secondary" type="button">Copy JSON</button>
            <button id="openJsonBtn" class="btn btn-sm btn-outline-secondary" type="button">Open JSON</button>
          </div>
        </div>
      </div>
      <div class="col-lg-8">
        <div class="glass p-4 h-100">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div>
              <div class="h5 mb-0 fw-bold">Score Breakdown</div>
              <div class="subtle small">Chart comes directly from runner.py chart_data</div>
            </div>
            <span class="pill" id="verdictPill">verdict: ‚Äî</span>
          </div>
          <canvas id="breakdownChart" height="120"></canvas>
        </div>
      </div>
    </div>

    <!-- CATEGORY CARDS -->
    <div id="cardsArea" class="row g-3 mb-4" style="display:none;">
      <div class="col-md-6 col-lg-3">
        <div class="mini-card">
          <div class="label">SEO</div>
          <div class="value" id="seoScore">‚Äî</div>
          <div class="hint">Title, meta, H1, canonical, image ALT</div>
          <!-- NEW: SEO Extras Inline Pills -->
          <div class="mt-3 kv" id="seoExtrasKv"></div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="mini-card">
          <div class="label">Performance</div>
          <div class="value" id="perfScore">‚Äî</div>
          <div class="hint">Load time, size, scripts, styles</div>
          <!-- NEW: Performance Extras Inline Pills -->
          <div class="mt-3 kv" id="perfExtrasKv"></div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="mini-card">
          <div class="label">Links</div>
          <div class="value" id="linksScore">‚Äî</div>
          <div class="hint">Internal vs external structure</div>
          <!-- NEW: Links Inline Pills -->
          <div class="mt-3 kv" id="linksKv"></div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="mini-card">
          <div class="label">Security</div>
          <div class="value" id="secScore">‚Äî</div>
          <div class="hint">HTTPS, HSTS, response status</div>
          <!-- NEW: Security Inline Pills -->
          <div class="mt-3 kv" id="secKv"></div>
        </div>
      </div>
    </div>

    <!-- DETAILED TABLES (from runner.py extras) -->
    <div id="detailsArea" class="row g-3 mb-4" style="display:none;">
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="sect-head">
            <div class="title">SEO Details</div>
            <span class="pill">breakdown.seo.extras</span>
          </div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <tbody id="seoTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="sect-head">
            <div class="title">Performance Details</div>
            <span class="pill">breakdown.performance.extras</span>
          </div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <tbody id="perfTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="sect-head">
            <div class="title">Links Details</div>
            <span class="pill">breakdown.links</span>
          </div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <tbody id="linksTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="sect-head">
            <div class="title">Security Details</div>
            <span class="pill">breakdown.security</span>
          </div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <tbody id="secTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- DYNAMIC OUTPUT -->
    <div id="dynamicArea" class="row g-3" style="display:none;">
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="h5 fw-bold mb-0">Highlights</div>
            <span class="pill">runner.dynamic.cards</span>
          </div>
          <div id="dynamicCards" class="d-grid gap-2"></div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="h5 fw-bold mb-0">Details</div>
            <span class="pill">runner.dynamic.kv</span>
          </div>
          <div class="table-responsive">
            <table class="table table-sm kv-table align-middle mb-0">
              <tbody id="kvBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="text-center mt-5 subtle small">
      ¬© FF Tech ‚Ä¢ WebSocket <code>/ws</code> ‚Ä¢ REST <code>/api/audit/run</code> ‚Ä¢ PDF <code>/api/audit/pdf</code>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // =========================================================
    // CONTROLLER ‚Äì FULL RENDERING OF RUNNER.PY RESULT
    // (keeps same inputs/outputs/links)
    // =========================================================
    const REST_FALLBACK_AFTER_MS = 9000;
    const AUTO_SCROLL_ON_RESULT = true;
    let ws = null;
    let lastResult = null;
    let chart = null;
    let fallbackTimer = null;
    let auditInProgress = false;

    const el = (id) => document.getElementById(id);

    // Theme toggle
    const themeKey = "fftech_theme";
    function setTheme(theme) {
      document.documentElement.setAttribute("data-bs-theme", theme);
      localStorage.setItem(themeKey, theme);
    }
    (function initTheme() {
      const saved = localStorage.getItem(themeKey);
      if (saved) setTheme(saved);
    })();
    el("themeToggle").addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-bs-theme") || "dark";
      setTheme(current === "dark" ? "light" : "dark");
    });

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;").replaceAll("'", "&#39;");
    }

    function showAlert(message, type="info", persist=false) {
      const area = el("alertArea");
      const div = document.createElement("div");
      div.className = `alert alert-${type} mb-2 fade-in`;
      div.innerHTML = `
        <div class="d-flex align-items-start justify-content-between gap-3">
          <div>${message}</div>
          <button type="button" class="btn-close" aria-label="Close"></button>
        </div>`;
      div.querySelector(".btn-close").onclick = () => div.remove();
      area.prepend(div);
      if (!persist) setTimeout(() => div.remove(), 6500);
    }

    function setStage(status, percent) {
      const p = Math.max(0, Math.min(100, parseInt(percent || 0)));
      el("progressBar").style.width = `${p}%`;
      el("progressText").textContent = `${p}%`;
      el("statusText").textContent = status || "working";
      const bar = el("progressBar");
      bar.classList.remove("bg-info","bg-success","bg-warning","bg-danger");
      if (status === "error" || status === "failed") bar.classList.add("bg-danger");
      else if (p >= 100) bar.classList.add("bg-success");
      else bar.classList.add("bg-info");
      const dot = el("stageDot");
      dot.classList.remove("ok","warn","bad","info");
      if (status === "error" || status === "failed") dot.classList.add("bad");
      else if (p >= 100) dot.classList.add("ok");
      else dot.classList.add("info");
    }

    function setWsStatus(connected) {
      el("wsStatus").textContent = connected ? "WS: Connected" : "WS: Disconnected";
      el("wsStatus").style.opacity = connected ? "1" : "0.75";
    }

    function wsUrl() {
      const loc = window.location;
      const proto = loc.protocol === "https:" ? "wss:" : "ws:";
      return `${proto}//${loc.host}/ws`;
    }

    function debugSet(obj) {
      el("debugBox").textContent = JSON.stringify(obj, null, 2);
    }

    function extractRunnerResult(obj) {
      if (!obj || typeof obj !== "object") return null;
      if (obj.audited_url && typeof obj.overall_score !== "undefined") return obj;
      if (obj.result && obj.result.audited_url) return obj.result;
      if (obj.payload && obj.payload.audited_url) return obj.payload;
      if (obj.data && obj.data.audited_url) return obj.data;
      return null;
    }

    function extractError(obj) {
      if (!obj || typeof obj !== "object") return null;
      return obj.error || (obj.payload && obj.payload.error) || null;
    }

    function normalizeUrl(input) {
      let url = (input || "").trim();
      if (!url) return "";
      if (!/^https?:\/\//i.test(url)) {
        url = "https://" + url;
      }
      return url;
    }

    function addKvPill(container, label, value) {
      if (value === null || value === undefined || String(value).trim() === "") return;
      const span = document.createElement("span");
      span.className = "kv-item";
      span.textContent = `${label}: ${value}`;
      container.appendChild(span);
    }

    function addKvRow(tbody, key, value) {
      if (value === null || value === undefined || String(value).trim() === "") return;
      const tr = document.createElement("tr");
      tr.innerHTML = `<th class="text-nowrap" style="width:40%">${escapeHtml(key)}</th>
                      <td>${escapeHtml(String(value))}</td>`;
      tbody.appendChild(tr);
    }

    function renderResult(r) {
      lastResult = r;
      auditInProgress = false;
      clearTimeout(fallbackTimer);

      // Reset areas
      el("resultsArea").style.display = "none";
      el("cardsArea").style.display = "none";
      el("dynamicArea").style.display = "none";
      el("detailsArea").style.display = "none";
      el("pdfBtn").disabled = true;

      const error = extractError(r);
      if (error) {
        showAlert(buildHumanError(error), "danger", true);
        setStage("failed", 100);
        return;
      }

      // Show main areas
      el("resultsArea").style.display = "";
      el("cardsArea").style.display = "";
      el("dynamicArea").style.display = "";
      el("detailsArea").style.display = "";

      el("lastRunAt").textContent = new Date().toLocaleString();

      const breakdown = r.breakdown || {};
      const perfExtras = (breakdown.performance || {}).extras || {};
      const seoExtras = (breakdown.seo || {}).extras || {};
      const linksData = breakdown.links || {};
      const secData = breakdown.security || {};

      const score = parseInt(r.overall_score || 0);
      const seo = breakdown.seo?.score ?? 0;
      const perf = breakdown.performance?.score ?? 0;
      const links = breakdown.links?.score ?? 0;
      const sec = breakdown.security?.score ?? 0;

      const deg = Math.max(0, Math.min(360, (score / 100) * 360));
      el("scoreRing").style.setProperty("--deg", `${deg}deg`);
      el("overallScore").textContent = score;
      el("gradeText").textContent = r.grade || "‚Äî";
      el("auditedUrl").textContent = `Audited: ${r.audited_url || "‚Äî"}`;

      el("seoScore").textContent = seo;
      el("perfScore").textContent = perf;
      el("linksScore").textContent = links;
      el("secScore").textContent = sec;

      const fetcher = perfExtras.fetcher ?? "‚Äî";
      el("fetcherPill").textContent = `fetcher: ${fetcher}`;

      el("verdictPill").textContent = `verdict: ${score >= 80 ? "Healthy" : "Needs Improvement"}`;

      // Chart
      let labels = ["SEO", "Performance", "Links", "Security"];
      let dataPoints = [seo, perf, links, sec];
      let colors = ["#fbbf24", "#38bdf8", "#22c55e", "#ef4444"];

      const chartSpec = Array.isArray(r.chart_data) && r.chart_data.length ? r.chart_data[0] : null;
      if (chartSpec?.data?.labels && chartSpec?.data?.datasets?.[0]?.data) {
        labels = chartSpec.data.labels;
        dataPoints = chartSpec.data.datasets[0].data;
        colors = chartSpec.data.datasets[0].backgroundColor || colors;
      }
      const ctx = el("breakdownChart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "bar",
        data: { labels, datasets: [{ label: "Score", data: dataPoints, backgroundColor: colors, borderRadius: 12, borderSkipped: false }] },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true, max: 100, grid: { color: "rgba(255,255,255,.10)" } },
            x: { grid: { display: false } }
          }
        }
      });

      // ==== NEW: Inline KV pills under each category ====
      // SEO extras pills
      const seoKv = el("seoExtrasKv"); seoKv.innerHTML = "";
      const titleText = seoExtras.title ? `${seoExtras.title}` : "";
      if (titleText) addKvPill(seoKv, "title_len", String(titleText).length);
      if (typeof seoExtras.meta_description_present === "boolean") addKvPill(seoKv, "meta_desc", seoExtras.meta_description_present ? "present" : "missing");
      if (seoExtras.canonical) addKvPill(seoKv, "canonical", "yes");
      if (typeof seoExtras.h1_count !== "undefined") addKvPill(seoKv, "h1_count", seoExtras.h1_count);
      if (typeof seoExtras.images_total !== "undefined" && typeof seoExtras.images_missing_alt !== "undefined") {
        addKvPill(seoKv, "image_alt_missing", `${seoExtras.images_missing_alt}/${seoExtras.images_total}`);
      }

      // Performance extras pills
      const perfKv = el("perfExtrasKv"); perfKv.innerHTML = "";
      if (typeof perfExtras.load_ms !== "undefined") addKvPill(perfKv, "load_ms", perfExtras.load_ms);
      if (typeof perfExtras.bytes !== "undefined") {
        const kb = Math.max(0, parseInt(perfExtras.bytes, 10) || 0) / 1024;
        addKvPill(perfKv, "bytes", `${kb.toFixed(1)} KB`);
      }
      if (typeof perfExtras.scripts !== "undefined") addKvPill(perfKv, "scripts", perfExtras.scripts);
      if (typeof perfExtras.styles !== "undefined") addKvPill(perfKv, "styles", perfExtras.styles);

      // Links pills
      const linksKv = el("linksKv"); linksKv.innerHTML = "";
      if (typeof linksData.internal_links_count !== "undefined") addKvPill(linksKv, "internal", linksData.internal_links_count);
      if (typeof linksData.external_links_count !== "undefined") addKvPill(linksKv, "external", linksData.external_links_count);
      if (typeof linksData.total_links_count !== "undefined") addKvPill(linksKv, "total", linksData.total_links_count);

      // Security pills
      const secKv = el("secKv"); secKv.innerHTML = "";
      if (typeof secData.https === "boolean") addKvPill(secKv, "https", secData.https ? "yes" : "no");
      if (typeof secData.hsts === "boolean") addKvPill(secKv, "hsts", secData.hsts ? "yes" : "no");
      if (typeof secData.status_code !== "undefined") addKvPill(secKv, "status", secData.status_code);
      if (secData.server) addKvPill(secKv, "server", secData.server);

      // ==== NEW: Detailed tables (from runner.py extras) ====
      // SEO table
      const seoBody = el("seoTableBody"); seoBody.innerHTML = "";
      addKvRow(seoBody, "Title (length)", titleText ? `${String(titleText).length} chars` : "");
      addKvRow(seoBody, "Meta description", typeof seoExtras.meta_description_present === "boolean" ? (seoExtras.meta_description_present ? "Present" : "Missing") : "");
      addKvRow(seoBody, "Canonical", seoExtras.canonical ? "Yes" : "");
      addKvRow(seoBody, "H1 count", typeof seoExtras.h1_count !== "undefined" ? String(seoExtras.h1_count) : "");
      if (typeof seoExtras.images_total !== "undefined" && typeof seoExtras.images_missing_alt !== "undefined") {
        addKvRow(seoBody, "Images alt missing", `${seoExtras.images_missing_alt}/${seoExtras.images_total}`);
      }

      // Performance table
      const perfBody = el("perfTableBody"); perfBody.innerHTML = "";
      addKvRow(perfBody, "Load time (ms)", typeof perfExtras.load_ms !== "undefined" ? String(perfExtras.load_ms) : "");
      addKvRow(perfBody, "Page size", typeof perfExtras.bytes !== "undefined" ? `${(Math.max(0, parseInt(perfExtras.bytes, 10) || 0)/1024).toFixed(1)} KB` : "");
      addKvRow(perfBody, "Scripts", typeof perfExtras.scripts !== "undefined" ? String(perfExtras.scripts) : "");
      addKvRow(perfBody, "Stylesheets", typeof perfExtras.styles !== "undefined" ? String(perfExtras.styles) : "");
      addKvRow(perfBody, "Fetcher", fetcher);

      // Links table
      const linksBody = el("linksTableBody"); linksBody.innerHTML = "";
