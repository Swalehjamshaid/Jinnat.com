<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FF Tech â€“ World-Class AI Web Audit</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
      min-height: 100vh;
    }
    .card {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 16px;
      box-shadow: 0 12px 35px rgba(0,0,0,0.45);
    }
    .audit-title {
      font-weight: 800;
      letter-spacing: 0.6px;
    }
    .progress {
      height: 14px;
      background: #020617;
    }
    .progress-bar {
      background: linear-gradient(90deg, #3b82f6, #22c55e);
    }
    .log-box {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 12px;
      padding: 12px;
      height: 170px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.85rem;
      color: #22c55e;
    }
    .badge-fast {
      background: linear-gradient(90deg,#f59e0b,#ef4444);
    }
  </style>
</head>
<body>

<div class="container py-5">

  <!-- Header -->
  <div class="row mb-4">
    <div class="col text-center">
      <h2 class="audit-title">ðŸš€ FF Tech â€“ International AI Web Audit</h2>
      <p class="text-secondary">Top-1% audit engine â€¢ Ultra-fast â€¢ AI-driven insights</p>
    </div>
  </div>

  <!-- URL + Controls -->
  <div class="row mb-4">
    <div class="col-lg-10 mx-auto">
      <div class="card p-4">
        <label class="form-label">Website URL</label>
        <div class="input-group mb-3">
          <input id="urlInput" class="form-control" placeholder="https://www.example.com" />
          <button class="btn btn-primary" onclick="startAudit()">Start Audit</button>
        </div>

        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="fastMode" checked>
          <label class="form-check-label">
            âš¡ Ultra-Fast Mode (first 5 pages only)
            <span class="badge badge-fast ms-2">Recommended</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Progress -->
  <div class="row mb-4">
    <div class="col-lg-10 mx-auto">
      <div class="card p-4">
        <h6>Audit Progress</h6>
        <div class="progress mt-2">
          <div id="progressBar" class="progress-bar" style="width:0%"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card p-4">
        <h6>SEO, Performance & Accessibility</h6>
        <canvas id="scoreChart"></canvas>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card p-4">
        <h6>Broken Links & Issues</h6>
        <canvas id="issueChart"></canvas>
      </div>
    </div>
  </div>

  <!-- AI Recommendations -->
  <div class="row mt-4">
    <div class="col-lg-12">
      <div class="card p-4">
        <h6>ðŸ§  AI Recommendations</h6>
        <ul id="aiTips" class="text-secondary"></ul>
      </div>
    </div>
  </div>

  <!-- Logs + PDF -->
  <div class="row mt-4">
    <div class="col-lg-12">
      <div class="card p-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0">Live Audit Log</h6>
          <button class="btn btn-outline-success btn-sm" onclick="downloadPDF()">ðŸ“„ Download PDF Report</button>
        </div>
        <div id="logBox" class="log-box"></div>
      </div>
    </div>
  </div>

</div>

<script>
let ws;

const scoreChart = new Chart(document.getElementById('scoreChart'), {
  type: 'radar',
  data: {
    labels: ['SEO', 'Performance', 'Accessibility', 'Security'],
    datasets: [{
      data: [0,0,0,0],
      fill: true
    }]
  },
  options: { scales: { r: { min: 0, max: 100 } } }
});

const issueChart = new Chart(document.getElementById('issueChart'), {
  type: 'doughnut',
  data: {
    labels: ['Broken Links', 'Warnings', 'Passed'],
    datasets: [{ data: [0,0,0] }]
  }
});

function log(msg) {
  const box = document.getElementById('logBox');
  box.innerHTML += msg + '<br>';
  box.scrollTop = box.scrollHeight;
}

function startAudit() {
  const url = document.getElementById('urlInput').value;
  const fast = document.getElementById('fastMode').checked;

  document.getElementById('logBox').innerHTML = '';
  document.getElementById('aiTips').innerHTML = '';
  document.getElementById('progressBar').style.width = '0%';

  ws = new WebSocket(`ws://${location.host}/ws/audit-progress?url=${encodeURIComponent(url)}&fast=${fast}`);

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    if (data.progress !== undefined) {
      document.getElementById('progressBar').style.width = data.progress + '%';
    }

    if (data.log) log(data.log);

    if (data.scores) {
      scoreChart.data.datasets[0].data = data.scores;
      scoreChart.update();
    }

    if (data.issues) {
      issueChart.data.datasets[0].data = data.issues;
      issueChart.update();
    }

    if (data.ai_recommendations) {
      const ul = document.getElementById('aiTips');
      ul.innerHTML = '';
      data.ai_recommendations.forEach(tip => {
        ul.innerHTML += `<li>${tip}</li>`;
      });
    }
  };
}

function downloadPDF() {
  window.open('/audit/report/pdf', '_blank');
}
</script>

</body>
</html>
