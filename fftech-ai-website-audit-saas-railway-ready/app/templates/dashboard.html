<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - FF Tech AI Audit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar { width: 260px; height: 100vh; background: #1a202c; color: white; position: fixed; }
        .main-content { margin-left: 260px; padding: 40px; background: #f7fafc; min-height: 100vh; }
        .chart-container { position: relative; height: 200px; width: 100%; }
    </style>
</head>
<body>

<div class="sidebar p-6">
    <h2 class="text-2xl font-bold mb-10 text-blue-400">FF Tech AI</h2>
    <nav class="space-y-4">
        <a href="/dashboard" class="block py-2.5 px-4 rounded transition bg-blue-600">Dashboard</a>
        <a href="#" class="block py-2.5 px-4 rounded transition hover:bg-gray-700 text-gray-400">My Reports</a>
        <a href="#" class="block py-2.5 px-4 rounded transition hover:bg-gray-700 text-gray-400">Settings</a>
    </nav>
</div>

<div class="main-content">
    <header class="flex justify-between items-center mb-10">
        <h1 class="text-3xl font-bold text-gray-800">Website Audit Dashboard</h1>
        <div class="user-info text-gray-600">Welcome, {{ user.email }}</div>
    </header>

    <div class="bg-white p-8 rounded-xl shadow-sm mb-10 border border-gray-100">
        <label class="block text-sm font-medium text-gray-700 mb-2">Enter Website URL</label>
        <div class="flex gap-4">
            <input type="url" id="urlInput" placeholder="https://example.com" 
                   class="flex-1 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            <button onclick="runAudit()" id="auditBtn" 
                    class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                Start Analysis
            </button>
        </div>
    </div>

    <div id="resultsArea" style="display: none;">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 text-center">
                <h3 class="text-gray-500 font-medium mb-4">Performance</h3>
                <div class="chart-container"><canvas id="perfChart"></canvas></div>
                <div id="perfValue" class="text-3xl font-bold mt-4 text-green-600">0%</div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 text-center">
                <h3 class="text-gray-500 font-medium mb-4">SEO</h3>
                <div class="chart-container"><canvas id="seoChart"></canvas></div>
                <div id="seoValue" class="text-3xl font-bold mt-4 text-blue-600">0%</div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 text-center">
                <h3 class="text-gray-500 font-medium mb-4">Accessibility</h3>
                <div class="chart-container"><canvas id="a11yChart"></canvas></div>
                <div id="a11yValue" class="text-3xl font-bold mt-4 text-orange-500">0%</div>
            </div>
        </div>

        <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100">
            <h3 class="text-xl font-bold mb-6">Key Improvements Needed</h3>
            <ul id="recList" class="space-y-4"></ul>
        </div>
    </div>
</div>

<script>
let charts = {};

function createChart(id, score, color) {
    if (charts[id]) charts[id].destroy();
    const ctx = document.getElementById(id).getContext('2d');
    charts[id] = new Chart(ctx, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [score, 100 - score],
                backgroundColor: [color, '#edf2f7'],
                borderWidth: 0,
                circumference: 180,
                rotation: 270
            }]
        },
        options: { cutout: '85%', plugins: { legend: { display: false } } }
    });
}

async function runAudit() {
    const url = document.getElementById('urlInput').value;
    const btn = document.getElementById('auditBtn');
    if (!url) return alert("Please enter a URL");

    btn.disabled = true;
    btn.innerText = "Analyzing...";
    document.getElementById('resultsArea').style.display = 'none';

    try {
        const res = await fetch('/api/audit', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({url: url})
        });
        const data = await res.json();

        // Update UI
        document.getElementById('resultsArea').style.display = 'block';
        document.getElementById('perfValue').innerText = data.metrics.performance + '%';
        document.getElementById('seoValue').innerText = data.metrics.seo + '%';
        document.getElementById('a11yValue').innerText = data.metrics.accessibility + '%';

        // Draw Charts
        createChart('perfChart', data.metrics.performance, '#48bb78');
        createChart('seoChart', data.metrics.seo, '#4299e1');
        createChart('a11yChart', data.metrics.accessibility, '#ed8936');

        // Render Recommendations
        const list = document.getElementById('recList');
        list.innerHTML = data.summary.recommendations.map(r => 
            `<li class="flex items-center text-gray-700 bg-gray-50 p-4 rounded-lg">
                <span class="mr-3 text-red-500">‚óè</span> ${r}
            </li>`
        ).join('');

    } catch (e) {
        alert("Audit failed. Ensure your server is running.");
    } finally {
        btn.disabled = false;
        btn.innerText = "Start Analysis";
    }
}
</script>

</body>
</html>
